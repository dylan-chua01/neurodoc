{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 102, "column": 0}, "map": {"version":3,"sources":["file:///Users/dylanchua/Documents/Personal/Code/neurodocument/lib/db.ts"],"sourcesContent":["// lib/db.ts\n// \"use server\";\nimport { neon } from \"@neondatabase/serverless\";\nimport { GoogleGenerativeAIEmbeddings } from \"@langchain/google-genai\";\nimport { PGVectorStore } from \"@langchain/community/vectorstores/pgvector\";\nimport { Pool } from \"pg\";\n\n\nconst pool = new Pool({\n  connectionString: process.env.DATABASE_URL,\n  ssl: {\n    rejectUnauthorized: false,\n  },\n});\n\nexport const db = pool;\nexport async function getDbConnection() {\n  if (!process.env.DATABASE_URL) {\n    throw new Error('Neon Database URL is not defined');\n  }\n  return neon(process.env.DATABASE_URL);\n}\n\nexport async function getVectorStore(fileUrl: string) {\n    const embeddings = new GoogleGenerativeAIEmbeddings({\n      modelName: \"embedding-001\",\n      apiKey: process.env.GEMINI_API_KEY!\n    });\n  \n    const config = {\n      postgresConnectionOptions: {\n        connectionString: process.env.DATABASE_URL!\n      },\n      tableName: \"pdf_embeddings\",\n      columns: {\n        idColumnName: \"id\",\n        vectorColumnName: \"embedding\",\n        contentColumnName: \"content\",\n        metadataColumnName: \"metadata\",\n      },\n      filter: {\n        original_file_url: fileUrl // Add filter to scope to this PDF\n      }\n    };\n  \n    return await PGVectorStore.initialize(embeddings, config);\n  }"],"names":[],"mappings":"AAAA,YAAY;AACZ,gBAAgB;;;;;;AAChB;AACA;AAAA;AACA;AAAA;AACA;;;;;;;;;;;AAGA,MAAM,OAAO,IAAI,oGAAA,CAAA,OAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;QACH,oBAAoB;IACtB;AACF;AAEO,MAAM,KAAK;AACX,eAAe;IACpB,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;QAC7B,MAAM,IAAI,MAAM;IAClB;IACA,OAAO,CAAA,GAAA,wJAAA,CAAA,OAAI,AAAD,EAAE,QAAQ,GAAG,CAAC,YAAY;AACtC;AAEO,eAAe,eAAe,OAAe;IAChD,MAAM,aAAa,IAAI,sKAAA,CAAA,+BAA4B,CAAC;QAClD,WAAW;QACX,QAAQ,QAAQ,GAAG,CAAC,cAAc;IACpC;IAEA,MAAM,SAAS;QACb,2BAA2B;YACzB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;QAC5C;QACA,WAAW;QACX,SAAS;YACP,cAAc;YACd,kBAAkB;YAClB,mBAAmB;YACnB,oBAAoB;QACtB;QACA,QAAQ;YACN,mBAAmB,QAAQ,kCAAkC;QAC/D;IACF;IAEA,OAAO,MAAM,8KAAA,CAAA,gBAAa,CAAC,UAAU,CAAC,YAAY;AACpD","debugId":null}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///Users/dylanchua/Documents/Personal/Code/neurodocument/app/api/get-chat-history/route.ts"],"sourcesContent":["// app/api/get-chat-history/route.ts\nimport { currentUser } from \"@clerk/nextjs/server\";\nimport { db } from \"@/lib/db\";\nimport { NextResponse } from \"next/server\";\n\nexport async function POST(req: Request) {\n  const user = await currentUser();\n\n  if (!user?.id) {\n    return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  }\n\n  const { fileUrl } = await req.json();\n\n  if (!fileUrl) {\n    return NextResponse.json({ error: \"Missing fileUrl\" }, { status: 400 });\n  }\n\n  try {\n    const result = await db.query(\n      `SELECT question, answer, created_at FROM chat_history \n       WHERE user_id = $1 AND file_url = $2 \n       ORDER BY created_at ASC`,\n      [user.id, fileUrl]\n    );\n\n    return NextResponse.json({ history: result.rows });\n  } catch (err) {\n    console.error(\"Error fetching chat history:\", err);\n    return NextResponse.json(\n      { error: \"Server error\" }, \n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":"AAAA,oCAAoC;;;;AACpC;AACA;AACA;;;;;;;;AAEO,eAAe,KAAK,GAAY;IACrC,MAAM,OAAO,MAAM,CAAA,GAAA,4LAAA,CAAA,cAAW,AAAD;IAE7B,IAAI,CAAC,MAAM,IAAI;QACb,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;IAEA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,IAAI;IAElC,IAAI,CAAC,SAAS;QACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAkB,GAAG;YAAE,QAAQ;QAAI;IACvE;IAEA,IAAI;QACF,MAAM,SAAS,MAAM,2GAAA,CAAA,KAAE,CAAC,KAAK,CAC3B,CAAC;;8BAEuB,CAAC,EACzB;YAAC,KAAK,EAAE;YAAE;SAAQ;QAGpB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS,OAAO,IAAI;QAAC;IAClD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAe,GACxB;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}