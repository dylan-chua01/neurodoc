module.exports = {

"[project]/.next-internal/server/app/api/summaries/[id]/quiz/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/@opentelemetry/api [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@opentelemetry/api", () => require("@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/node:crypto [external] (node:crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/pg [external] (pg, esm_import)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
const mod = await __turbopack_context__.y("pg");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[project]/lib/db.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
// lib/db.ts
// "use server";
__turbopack_context__.s({
    "db": (()=>db),
    "getDbConnection": (()=>getDbConnection),
    "getVectorStore": (()=>getVectorStore)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$neondatabase$2f$serverless$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@neondatabase/serverless/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$google$2d$genai$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@langchain/google-genai/index.js [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$google$2d$genai$2f$dist$2f$embeddings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@langchain/google-genai/dist/embeddings.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$community$2f$vectorstores$2f$pgvector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/@langchain/community/vectorstores/pgvector.js [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$community$2f$dist$2f$vectorstores$2f$pgvector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@langchain/community/dist/vectorstores/pgvector.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/pg [external] (pg, esm_import)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$community$2f$vectorstores$2f$pgvector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__,
    __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$community$2f$dist$2f$vectorstores$2f$pgvector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__,
    __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__
]);
([__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$community$2f$vectorstores$2f$pgvector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$community$2f$dist$2f$vectorstores$2f$pgvector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__, __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
;
;
;
const pool = new __TURBOPACK__imported__module__$5b$externals$5d2f$pg__$5b$external$5d$__$28$pg$2c$__esm_import$29$__["Pool"]({
    connectionString: process.env.DATABASE_URL,
    ssl: {
        rejectUnauthorized: false
    }
});
const db = pool;
async function getDbConnection() {
    if (!process.env.DATABASE_URL) {
        throw new Error('Neon Database URL is not defined');
    }
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$neondatabase$2f$serverless$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["neon"])(process.env.DATABASE_URL);
}
async function getVectorStore(fileUrl) {
    const embeddings = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$google$2d$genai$2f$dist$2f$embeddings$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["GoogleGenerativeAIEmbeddings"]({
        modelName: "embedding-001",
        apiKey: process.env.GEMINI_API_KEY
    });
    const config = {
        postgresConnectionOptions: {
            connectionString: process.env.DATABASE_URL
        },
        tableName: "pdf_embeddings",
        columns: {
            idColumnName: "id",
            vectorColumnName: "embedding",
            contentColumnName: "content",
            metadataColumnName: "metadata"
        },
        filter: {
            original_file_url: fileUrl // Add filter to scope to this PDF
        }
    };
    return await __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$langchain$2f$community$2f$dist$2f$vectorstores$2f$pgvector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PGVectorStore"].initialize(embeddings, config);
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[project]/utils/prompts.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "SUMMARY_SYSTEM_PROMPT": (()=>SUMMARY_SYSTEM_PROMPT)
});
const SUMMARY_SYSTEM_PROMPT = `You are an expert document analyst who creates precision summaries that transform complex documents into actionable intelligence. Adapt your output based on document type and audience needs while maintaining professional depth and engagement.

# [Document Title: Specific and Descriptive]
â€¢ ðŸŽ¯ Core Thesis: One compelling sentence capturing the document's essence
â€¢ ðŸ“Œ Context: Optional secondary framing point if needed

## Document Profile
â€¢ ðŸ“„ Type: [Academic/Legal/Business/Technical] 
â€¢ ðŸ‘¥ Primary Audience: [Students/Lawyers/Executives/Technicians]
â€¢ â³ Time Relevance: [Key dates/periods/deadlines]
â€¢ ðŸ›ï¸ Jurisdiction/Scope: [For legal/business docs]

## Decision-Making Essentials
â€¢ ðŸ”‘ [First evidence-based insight requiring action]
â€¢ ðŸ’¡ [Second significant finding with implications]
â€¢ ðŸ“Š [Third data-driven conclusion with impact]
â€¢ ðŸ”„ Time-sensitive elements: [ðŸŸ¢ Low/ðŸŸ¡ Medium/ðŸ”´ High urgency]

## "If You Only Remember 3 Things"
â€¢ â­ [Most critical takeaway with specific details]
â€¢ â­ [Second must-know point with practical relevance]
â€¢ â­ [Third essential insight with distinctive value]

## Actionable Intelligence
â€¢ âœ… [First practical application or recommendation]
â€¢ ðŸ› ï¸ [Second implementation strategy]
â€¢ ðŸ“ˆ [Third strategic consideration]
â€¢ â±ï¸ [Time-sensitive actions with deadlines]

## Key Metrics & Data Points
â€¢ ðŸ“ˆ [Primary Metric]: [Value] | [Context/Comparison] | [Significance]
â€¢ ðŸ’° [Financial Figure]: [Value] | [% change] | [Impact assessment]
â€¢ ðŸ“Š [Statistical Finding]: [Value] | [Confidence level] | [Implications]
â€¢ â±ï¸ [Time-based Data]: [Value] | [Trend direction] | [Forecast]
â€¢ ðŸ”¢ [Other Critical Number]: [Value] | [Benchmark comparison] | [Actionability]

## Stakeholder Impact Matrix
â€¢ ðŸ‘¥ [Group 1]: [Benefit level] | [Risk exposure] | [Required action]
â€¢ ðŸ‘¥ [Group 2]: [Benefit level] | [Risk exposure] | [Required action]
â€¢ ðŸ‘¥ [Group 3]: [Benefit level] | [Risk exposure] | [Required action]

## Terminology Decoder
â€¢ ðŸ“š [Key Term 1]: [Audience-appropriate definition]
â€¢ ðŸ” [Key Term 2]: [Simplified explanation]
â€¢ âš™ï¸ [Technical term]: [Field-specific clarification]

## Professional Evaluation
â€¢ ðŸ’ª Document Strength: [Methodology/evidence/innovation]
â€¢ âš ï¸ Caveat: [Limitation/bias/competitor concern] 
â€¢ ðŸš¨ Red Flags: [Unsubstantiated claims/contradictions/omissions]

## Professional Lens Filters
â€¢ ðŸŽ“ **Academic Perspective**
  - Theoretical Framework: [Key academic foundations]
  - Research Methodology: [Validity assessment â­â­â­â­â˜†]
  - Citation Highlights: [Most reference-worthy content]

â€¢ âš–ï¸ **Legal Perspective**
  - Precedent Value: [Case law/regulatory impact]
  - Frequently Contested Clauses: [Key legal pressure points]
  - Critical Deadlines: [Filing/compliance dates]

â€¢ ðŸ’° **Business Perspective**
  - Financial Impact: [Revenue/cost implications]
  - Market Intelligence: [Competitive positioning]
  - Implementation Complexity: [Resources/timeline/dependencies]

â€¢ âš™ï¸ **Technical Perspective**
  - Specifications: [Key technical requirements]
  - Integration Requirements: [System/compatibility notes]
  - Implementation Roadmap: [Step-by-step guidance]

## Action Pack
â€¢ ðŸ“§ Communication Template: [Key points for stakeholder briefing]
â€¢ ðŸ“Š Visualization-Ready Data: [Key metrics/comparisons]
â€¢ ðŸ—£ï¸ Talking Points: [For meetings/presentations/discussions]

## Final Synthesis
â€¢ ðŸ“Œ Ultimate Takeaway: [Single most important point]
â€¢ ðŸ”® Future Implications: [Emerging trends/long-term impact]

---

**Formatting Rules:**
1. Emoji Usage:
   - Choose emojis appropriate to subject matter
   - Use consistently for section headers
   - Keep professional (fewer emojis for formal documents)
   - Ensure emojis add meaning rather than decoration

2. Always:
   - Begin main points with "â€¢ [emoji]"
   - Maintain parallel structure throughout
   - Use Markdown headers (##, ###) for clear hierarchy
   - Keep explanations audience-appropriate
   - Color-code urgency where applicable (ðŸŸ¢/ðŸŸ¡/ðŸ”´)

3. Section Selection:
   - Include core sections for all documents
   - Adapt Professional Lens section based on document type
   - Emphasize sections most relevant to primary audience
   - Omit sections that don't apply to the document

4. Never:
   - Use numbered lists
   - Exceed 5 bullet points per section
   - Include inappropriate perspective for document type

**Quality Checks:**
âœ“ Decision-critical information prioritized
âœ“ Technical accuracy preserved
âœ“ Jargon explained for non-specialists
âœ“ Actionable insights highlighted
âœ“ Key numerical data clearly presented
âœ“ Source limitations acknowledged
âœ“ Visual elements (tables, color-coding) used purposefully
âœ“ Important metrics contextualized with benchmarks
`;
}}),
"[externals]/child_process [external] (child_process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/tty [external] (tty, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/node:events [external] (node:events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}}),
"[externals]/node:process [external] (node:process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}}),
"[externals]/node:util [external] (node:util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/fs/promises [external] (fs/promises, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs/promises", () => require("fs/promises"));

module.exports = mod;
}}),
"[project]/lib/geminiai.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "generateQuestions": (()=>generateQuestions),
    "generateSummaryFromGemini": (()=>generateSummaryFromGemini)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$utils$2f$prompts$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/utils/prompts.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@google/genai/dist/node/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$generative$2d$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@google/generative-ai/dist/index.mjs [app-route] (ecmascript)");
;
;
;
// Check for API key
if (!process.env.GEMINI_API_KEY) {
    throw new Error("âŒ Missing GEMINI_API_KEY. Please define it in .env.local");
}
// Initialize Gemini
const ai = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$genai$2f$dist$2f$node$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["GoogleGenAI"]({
    apiKey: process.env.GEMINI_API_KEY
});
const genAI = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$google$2f$generative$2d$ai$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["GoogleGenerativeAI"](process.env.GEMINI_API_KEY || "");
const generateSummaryFromGemini = async (pdfText)=>{
    try {
        const prompt = `${__TURBOPACK__imported__module__$5b$project$5d2f$utils$2f$prompts$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["SUMMARY_SYSTEM_PROMPT"]}

Transform this document into an engaging, easy-to-read summary with contextually relevant emojis and proper markdown formatting:

${pdfText}`;
        const response = await ai.models.generateContent({
            model: "gemini-1.5-flash",
            contents: [
                {
                    role: "user",
                    parts: [
                        {
                            text: prompt
                        }
                    ]
                }
            ]
        });
        // Some SDKs may return .candidates[0].content.parts[0].text instead of .text
        const summary = response?.text || response?.candidates?.[0]?.content?.parts?.[0]?.text;
        if (!summary) {
            throw new Error("âŒ Empty response from Gemini API");
        }
        return summary;
    } catch (error) {
        // Handle Gemini rate limit
        if (error?.status === 429) {
            throw new Error("âŒ RATE_LIMIT_EXCEEDED");
        }
        // Full error trace
        console.error("ðŸš¨ Gemini API Error:", {
            message: error.message,
            stack: error.stack,
            cause: error.cause,
            error
        });
        throw error;
    }
};
async function generateQuestions(summaryText) {
    const model = genAI.getGenerativeModel({
        model: "gemini-2.0-flash"
    });
    const prompt = `
You are a quiz generator. Based on the following summary, create exactly 8 high-quality quiz questions.
Mix multiple-choice questions (4 options each) with short-answer questions.

IMPORTANT FORMATTING RULES:
- Start each question with "QUESTION:" followed by the question text
- For multiple-choice, list options as "OPTION A:", "OPTION B:", etc.
- End each question with "ANSWER:" followed by the correct answer
- For MCQ answers, use just the letter (A, B, C, or D)
- For short answers, provide a concise but complete answer
- Separate each question with "---"

Example format:
QUESTION: What is the capital of France?
OPTION A: Berlin
OPTION B: Madrid  
OPTION C: Paris
OPTION D: Rome
ANSWER: C

---

QUESTION: Explain the main benefit of renewable energy.
ANSWER: Renewable energy sources like solar and wind are sustainable and don't deplete natural resources, making them environmentally friendly alternatives to fossil fuels.

---

Summary to create questions from:
${summaryText}

Generate the questions now:`;
    try {
        const result = await model.generateContent(prompt);
        const response = await result.response;
        const text = response.text();
        // Parse the structured response
        const questionBlocks = text.split('---').filter((block)=>block.trim());
        const parsed = questionBlocks.map((block)=>{
            const lines = block.trim().split('\n').filter((line)=>line.trim());
            let question = '';
            let options = [];
            let answer = '';
            for (const line of lines){
                const trimmedLine = line.trim();
                if (trimmedLine.startsWith('QUESTION:')) {
                    question = trimmedLine.replace('QUESTION:', '').trim();
                } else if (trimmedLine.startsWith('OPTION')) {
                    const optionText = trimmedLine.replace(/OPTION [A-D]:\s*/, '').trim();
                    if (optionText) options.push(optionText);
                } else if (trimmedLine.startsWith('ANSWER:')) {
                    answer = trimmedLine.replace('ANSWER:', '').trim();
                }
            }
            // Validate the parsed question
            if (!question || !answer) {
                return null;
            }
            // For MCQ, ensure we have 4 options and the answer is a letter
            if (options.length === 4 && [
                'A',
                'B',
                'C',
                'D'
            ].includes(answer)) {
                return {
                    question,
                    options,
                    answer,
                    type: 'mcq'
                };
            }
            // For short answer, ensure no options and answer is substantial
            if (options.length === 0 && answer.length > 10) {
                return {
                    question,
                    options: [],
                    answer,
                    type: 'short'
                };
            }
            return null;
        }).filter(Boolean);
        // Ensure we have at least some valid questions
        if (parsed.length === 0) {
            throw new Error("No valid questions could be parsed from the response");
        }
        return parsed;
    } catch (error) {
        console.error("Error generating questions:", error);
        // Fallback: generate simpler questions
        try {
            return await generateFallbackQuestions(summaryText);
        } catch (fallbackError) {
            console.error("Fallback question generation also failed:", fallbackError);
            throw new Error("Failed to generate quiz questions");
        }
    }
}
// Fallback question generator with simpler format
async function generateFallbackQuestions(summaryText) {
    const model = genAI.getGenerativeModel({
        model: "gemini-2.0-flash"
    });
    const prompt = `
Create 5 simple questions about this summary. Make them clear and answerable.

Format each as:
Q1: [question]
A1: [answer]

Q2: [question] 
A2: [answer]

Summary: ${summaryText}`;
    const result = await model.generateContent(prompt);
    const response = await result.response;
    const text = response.text();
    const questions = [];
    const lines = text.split('\n');
    for(let i = 0; i < lines.length; i++){
        const line = lines[i].trim();
        if (line.match(/^Q\d+:/)) {
            const question = line.replace(/^Q\d+:\s*/, '').trim();
            const nextLine = lines[i + 1]?.trim();
            if (nextLine && nextLine.match(/^A\d+:/)) {
                const answer = nextLine.replace(/^A\d+:\s*/, '').trim();
                if (question && answer) {
                    questions.push({
                        question,
                        options: [],
                        answer,
                        type: 'short'
                    });
                }
            }
        }
    }
    return questions;
}
}}),
"[project]/app/api/summaries/[id]/quiz/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
__turbopack_context__.s({
    "GET": (()=>GET)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/db.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$geminiai$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/lib/geminiai.ts [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
([__TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
;
;
async function GET(req, { params }) {
    try {
        const sql = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getDbConnection"])();
        const [summary] = await sql`
      SELECT title, summary_text FROM pdf_summaries WHERE id = ${params.id}
    `;
        if (!summary) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Summary not found"
            }, {
                status: 404
            });
        }
        // Generate questions with better error handling
        let questions;
        try {
            questions = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$lib$2f$geminiai$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["generateQuestions"])(summary.summary_text);
        } catch (error) {
            console.error("Error generating questions:", error);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "Failed to generate quiz questions. Please try again."
            }, {
                status: 500
            });
        }
        // Validate questions before returning
        const validQuestions = questions.filter((q)=>q.question && q.question.trim() !== '' && q.answer && q.answer.trim() !== '');
        if (validQuestions.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: "No valid questions could be generated from this summary."
            }, {
                status: 500
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            questions: validQuestions,
            summaryTitle: summary.title || "Untitled Summary"
        });
    } catch (error) {
        console.error("Error in quiz API:", error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: "Internal server error"
        }, {
            status: 500
        });
    }
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__c172cc81._.js.map