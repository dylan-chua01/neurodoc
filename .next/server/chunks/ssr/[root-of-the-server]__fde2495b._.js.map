{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///Users/dylanchua/Documents/Personal/Code/neurodocument/utils/prompts.ts"],"sourcesContent":["\nexport const SUMMARY_SYSTEM_PROMPT = `You are an expert document analyst who creates precision summaries that transform complex documents into actionable intelligence. Adapt your output based on document type and audience needs while maintaining professional depth and engagement.\n\n# [Document Title: Specific and Descriptive]\n• 🎯 Core Thesis: One compelling sentence capturing the document's essence\n• 📌 Context: Optional secondary framing point if needed\n\n## Document Profile\n• 📄 Type: [Academic/Legal/Business/Technical] \n• 👥 Primary Audience: [Students/Lawyers/Executives/Technicians]\n• ⏳ Time Relevance: [Key dates/periods/deadlines]\n• 🏛️ Jurisdiction/Scope: [For legal/business docs]\n\n## Decision-Making Essentials\n• 🔑 [First evidence-based insight requiring action]\n• 💡 [Second significant finding with implications]\n• 📊 [Third data-driven conclusion with impact]\n• 🔄 Time-sensitive elements: [🟢 Low/🟡 Medium/🔴 High urgency]\n\n## \"If You Only Remember 3 Things\"\n• ⭐ [Most critical takeaway with specific details]\n• ⭐ [Second must-know point with practical relevance]\n• ⭐ [Third essential insight with distinctive value]\n\n## Actionable Intelligence\n• ✅ [First practical application or recommendation]\n• 🛠️ [Second implementation strategy]\n• 📈 [Third strategic consideration]\n• ⏱️ [Time-sensitive actions with deadlines]\n\n## Key Metrics & Data Points\n• 📈 [Primary Metric]: [Value] | [Context/Comparison] | [Significance]\n• 💰 [Financial Figure]: [Value] | [% change] | [Impact assessment]\n• 📊 [Statistical Finding]: [Value] | [Confidence level] | [Implications]\n• ⏱️ [Time-based Data]: [Value] | [Trend direction] | [Forecast]\n• 🔢 [Other Critical Number]: [Value] | [Benchmark comparison] | [Actionability]\n\n## Stakeholder Impact Matrix\n• 👥 [Group 1]: [Benefit level] | [Risk exposure] | [Required action]\n• 👥 [Group 2]: [Benefit level] | [Risk exposure] | [Required action]\n• 👥 [Group 3]: [Benefit level] | [Risk exposure] | [Required action]\n\n## Terminology Decoder\n• 📚 [Key Term 1]: [Audience-appropriate definition]\n• 🔍 [Key Term 2]: [Simplified explanation]\n• ⚙️ [Technical term]: [Field-specific clarification]\n\n## Professional Evaluation\n• 💪 Document Strength: [Methodology/evidence/innovation]\n• ⚠️ Caveat: [Limitation/bias/competitor concern] \n• 🚨 Red Flags: [Unsubstantiated claims/contradictions/omissions]\n\n## Professional Lens Filters\n• 🎓 **Academic Perspective**\n  - Theoretical Framework: [Key academic foundations]\n  - Research Methodology: [Validity assessment ⭐⭐⭐⭐☆]\n  - Citation Highlights: [Most reference-worthy content]\n\n• ⚖️ **Legal Perspective**\n  - Precedent Value: [Case law/regulatory impact]\n  - Frequently Contested Clauses: [Key legal pressure points]\n  - Critical Deadlines: [Filing/compliance dates]\n\n• 💰 **Business Perspective**\n  - Financial Impact: [Revenue/cost implications]\n  - Market Intelligence: [Competitive positioning]\n  - Implementation Complexity: [Resources/timeline/dependencies]\n\n• ⚙️ **Technical Perspective**\n  - Specifications: [Key technical requirements]\n  - Integration Requirements: [System/compatibility notes]\n  - Implementation Roadmap: [Step-by-step guidance]\n\n## Action Pack\n• 📧 Communication Template: [Key points for stakeholder briefing]\n• 📊 Visualization-Ready Data: [Key metrics/comparisons]\n• 🗣️ Talking Points: [For meetings/presentations/discussions]\n\n## Final Synthesis\n• 📌 Ultimate Takeaway: [Single most important point]\n• 🔮 Future Implications: [Emerging trends/long-term impact]\n\n---\n\n**Formatting Rules:**\n1. Emoji Usage:\n   - Choose emojis appropriate to subject matter\n   - Use consistently for section headers\n   - Keep professional (fewer emojis for formal documents)\n   - Ensure emojis add meaning rather than decoration\n\n2. Always:\n   - Begin main points with \"• [emoji]\"\n   - Maintain parallel structure throughout\n   - Use Markdown headers (##, ###) for clear hierarchy\n   - Keep explanations audience-appropriate\n   - Color-code urgency where applicable (🟢/🟡/🔴)\n\n3. Section Selection:\n   - Include core sections for all documents\n   - Adapt Professional Lens section based on document type\n   - Emphasize sections most relevant to primary audience\n   - Omit sections that don't apply to the document\n\n4. Never:\n   - Use numbered lists\n   - Exceed 5 bullet points per section\n   - Include inappropriate perspective for document type\n\n**Quality Checks:**\n✓ Decision-critical information prioritized\n✓ Technical accuracy preserved\n✓ Jargon explained for non-specialists\n✓ Actionable insights highlighted\n✓ Key numerical data clearly presented\n✓ Source limitations acknowledged\n✓ Visual elements (tables, color-coding) used purposefully\n✓ Important metrics contextualized with benchmarks\n`\n"],"names":[],"mappings":";;;AACO,MAAM,wBAAwB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqHtC,CAAC","debugId":null}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///Users/dylanchua/Documents/Personal/Code/neurodocument/lib/geminiai.ts"],"sourcesContent":["import { SUMMARY_SYSTEM_PROMPT } from \"@/utils/prompts\";\nimport { GoogleGenAI } from \"@google/genai\";\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport { PromptTemplate } from \"@langchain/core/prompts\";\nimport { ChatGoogleGenerativeAI } from \"@langchain/google-genai\";\nimport { ConversationalRetrievalQAChain } from \"langchain/chains\";\n\n// Check for API key\nif (!process.env.GEMINI_API_KEY) {\n  throw new Error(\"❌ Missing GEMINI_API_KEY. Please define it in .env.local\");\n}\n\n\n// Initialize Gemini\nconst ai = new GoogleGenAI({ apiKey: process.env.GEMINI_API_KEY });\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || \"\");\n\nexport const generateSummaryFromGemini = async (pdfText: string) => {\n  try {\n    const prompt = `${SUMMARY_SYSTEM_PROMPT}\n\nTransform this document into an engaging, easy-to-read summary with contextually relevant emojis and proper markdown formatting:\n\n${pdfText}`;\n\n    const response = await ai.models.generateContent({\n      model: \"gemini-2.0-flash\",\n      contents: [\n        {\n          role: \"user\",\n          parts: [{ text: prompt }],\n        },\n      ],\n    });\n\n    // Some SDKs may return .candidates[0].content.parts[0].text instead of .text\n    const summary = (response as any)?.text ||\n                    (response as any)?.candidates?.[0]?.content?.parts?.[0]?.text;\n\n    if (!summary) {\n      throw new Error(\"❌ Empty response from Gemini API\");\n    }\n\n    return summary;\n\n  } catch (error: any) {\n    // Handle Gemini rate limit\n    if (error?.status === 429) {\n      throw new Error(\"❌ RATE_LIMIT_EXCEEDED\");\n    }\n\n    // Full error trace\n    console.error(\"🚨 Gemini API Error:\", {\n      message: error.message,\n      stack: error.stack,\n      cause: error.cause,\n      error,\n    });\n\n    throw error;\n  }\n};\n\nexport async function generateQuestions(summaryText: string) {\n  const model = genAI.getGenerativeModel({ model: \"gemini-2.0-flash\" });\n\n  const prompt = `\nBased on the following summary, create 10 multiple-choice or short-answer quiz questions.\nFormat them like this:\nQ: What is the capital of France?\nA) Berlin\nB) Madrid\nC) Paris\nD) Rome\nAnswer: C\n\nOr, for open-ended:\nQ: Explain Newton's first law.\nAnswer: An object in motion stays in motion unless acted upon by a force.\n\nSummary:\n${summaryText}\n`;\n\nconst result = await model.generateContent(prompt);\nconst response = await result.response;\nconst text = response.text();\n\nconst blocks = text.split(/Q:/).filter(Boolean);\n\nconst parsed = blocks.map((block) => {\n  const lines = block.trim().split(\"\\n\");\n  const questionLine = lines[0].trim();\n  const answerLine = lines.find((l) => l.startsWith(\"Answer:\")) || \"\";\n  const answer = answerLine.replace(\"Answer:\", \"\").trim();\n\n  const options = lines.slice(1, lines.indexOf(answerLine)).map((opt) =>\n    opt.replace(/[A-D]\\)/, \"\").trim()\n  );\n\n  return {\n    question: questionLine,\n    options: options.length > 0 ? options : undefined,\n    answer,\n  };\n});\n\nreturn parsed;\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAKA,oBAAoB;AACpB,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;IAC/B,MAAM,IAAI,MAAM;AAClB;AAGA,oBAAoB;AACpB,MAAM,KAAK,IAAI,0JAAA,CAAA,cAAW,CAAC;IAAE,QAAQ,QAAQ,GAAG,CAAC,cAAc;AAAC;AAChE,MAAM,QAAQ,IAAI,8JAAA,CAAA,qBAAkB,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI;AAE5D,MAAM,4BAA4B,OAAO;IAC9C,IAAI;QACF,MAAM,SAAS,GAAG,gHAAA,CAAA,wBAAqB,CAAC;;;;AAI5C,EAAE,SAAS;QAEP,MAAM,WAAW,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC;YAC/C,OAAO;YACP,UAAU;gBACR;oBACE,MAAM;oBACN,OAAO;wBAAC;4BAAE,MAAM;wBAAO;qBAAE;gBAC3B;aACD;QACH;QAEA,6EAA6E;QAC7E,MAAM,UAAU,AAAC,UAAkB,QAClB,UAAkB,YAAY,CAAC,EAAE,EAAE,SAAS,OAAO,CAAC,EAAE,EAAE;QAEzE,IAAI,CAAC,SAAS;YACZ,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO;IAET,EAAE,OAAO,OAAY;QACnB,2BAA2B;QAC3B,IAAI,OAAO,WAAW,KAAK;YACzB,MAAM,IAAI,MAAM;QAClB;QAEA,mBAAmB;QACnB,QAAQ,KAAK,CAAC,wBAAwB;YACpC,SAAS,MAAM,OAAO;YACtB,OAAO,MAAM,KAAK;YAClB,OAAO,MAAM,KAAK;YAClB;QACF;QAEA,MAAM;IACR;AACF;AAEO,eAAe,kBAAkB,WAAmB;IACzD,MAAM,QAAQ,MAAM,kBAAkB,CAAC;QAAE,OAAO;IAAmB;IAEnE,MAAM,SAAS,CAAC;;;;;;;;;;;;;;;AAelB,EAAE,YAAY;AACd,CAAC;IAED,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;IAC3C,MAAM,WAAW,MAAM,OAAO,QAAQ;IACtC,MAAM,OAAO,SAAS,IAAI;IAE1B,MAAM,SAAS,KAAK,KAAK,CAAC,MAAM,MAAM,CAAC;IAEvC,MAAM,SAAS,OAAO,GAAG,CAAC,CAAC;QACzB,MAAM,QAAQ,MAAM,IAAI,GAAG,KAAK,CAAC;QACjC,MAAM,eAAe,KAAK,CAAC,EAAE,CAAC,IAAI;QAClC,MAAM,aAAa,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,UAAU,CAAC,eAAe;QACjE,MAAM,SAAS,WAAW,OAAO,CAAC,WAAW,IAAI,IAAI;QAErD,MAAM,UAAU,MAAM,KAAK,CAAC,GAAG,MAAM,OAAO,CAAC,aAAa,GAAG,CAAC,CAAC,MAC7D,IAAI,OAAO,CAAC,WAAW,IAAI,IAAI;QAGjC,OAAO;YACL,UAAU;YACV,SAAS,QAAQ,MAAM,GAAG,IAAI,UAAU;YACxC;QACF;IACF;IAEA,OAAO;AACP","debugId":null}},
    {"offset": {"line": 417, "column": 0}, "map": {"version":3,"sources":["file:///Users/dylanchua/Documents/Personal/Code/neurodocument/app/%28logged-in%29/summaries/%5Bid%5D/quiz/page.tsx"],"sourcesContent":["import { getDbConnection } from \"@/lib/db\";\nimport { generateQuestions } from \"@/lib/geminiai\";\nimport { notFound } from \"next/navigation\";\nimport { ArrowLeft, Check, X } from \"lucide-react\";\nimport Link from \"next/link\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface QuizPageProps {\n  params: { id: string };\n}\n\nexport default async function QuizPage({ params }: QuizPageProps) {\n  const sql = await getDbConnection();\n  const [summary] = await sql`\n    SELECT summary_text, title FROM pdf_summaries WHERE id = ${params.id}\n  `;\n\n  if (!summary) {\n    notFound();\n  }\n\n  const rawQuestions = await generateQuestions(summary.summary_text);\n  \n  // Process questions to detect type (MCQ or open-ended)\n  const questions = rawQuestions.map((q: any) => {\n    const isMCQ = q.options?.length === 4;\n  \n    return {\n      text: q.question,\n      isMCQ,\n      options: q.options || [],\n      answer: q.answer,\n      selected: \"\",\n      revealed: false\n    };\n  });\n\n  return (\n    <div className=\"max-w-3xl mx-auto py-8 px-4\">\n      <div className=\"mb-6\">\n        <Button asChild variant=\"ghost\" className=\"pl-0\">\n          <Link href={`/summaries/${params.id}`} className=\"flex items-center\">\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back to Summary\n          </Link>\n        </Button>\n        <h1 className=\"text-3xl font-bold mt-4\">Test Your Knowledge</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Quiz for: <span className=\"font-medium text-primary\">{summary.title}</span>\n        </p>\n      </div>\n\n      {questions.length === 0 ? (\n        <div className=\"text-center py-12\">\n          <p className=\"text-lg text-muted-foreground\">No questions generated.</p>\n          <Button variant=\"outline\" className=\"mt-4\">\n            Try Again\n          </Button>\n        </div>\n      ) : (\n        <div className=\"space-y-6\">\n          {questions.map((q, index) => (\n            <div key={index} className=\"border rounded-lg overflow-hidden bg-card\">\n              <div className=\"p-6\">\n                <div className=\"flex items-start\">\n                  <div className=\"flex items-center justify-center bg-primary/10 text-primary rounded-full w-8 h-8 mr-4\">\n                    {index + 1}\n                  </div>\n                  <h2 className=\"text-lg font-semibold\">{q.text.split('?')[0]}?</h2>\n                </div>\n\n                {q.isMCQ ? (\n                  <div className=\"mt-4 space-y-3 ml-12\">\n                    {q.options?.map((opt, i) => (\n                      <div key={i} className=\"flex items-center\">\n                        <input\n                          type=\"radio\"\n                          id={`q${index}-opt${i}`}\n                          name={`q${index}`}\n                          className=\"peer hidden\"\n                        />\n                        <label\n                          htmlFor={`q${index}-opt${i}`}\n                          className=\"flex-1 p-3 border rounded-lg cursor-pointer peer-checked:border-primary peer-checked:bg-primary/5 transition-colors\"\n                        >\n                          <span className=\"font-medium text-primary mr-2\">\n                            {String.fromCharCode(97 + i)})\n                          </span>\n                          {opt}\n                        </label>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"mt-4 ml-12\">\n                    <textarea\n                      placeholder=\"Type your answer here...\"\n                      className=\"w-full p-3 border rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary\"\n                      rows={3}\n                    />\n                  </div>\n                )}\n\n                <div className=\"mt-4 flex justify-end space-x-3 ml-12\">\n                  <Button variant=\"outline\" size=\"sm\">\n                    <Check className=\"w-4 h-4 mr-2 text-green-500\" />\n                    Check Answer\n                  </Button>\n                  <Button variant=\"outline\" size=\"sm\">\n                    <X className=\"w-4 h-4 mr-2 text-red-500\" />\n                    Reveal Answer\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ))}\n\n          <div className=\"flex justify-between mt-8\">\n            <Button variant=\"outline\">Previous</Button>\n            <Button>Submit Quiz</Button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":"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","debugId":null}}]
}